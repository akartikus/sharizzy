<ion-header>
  <ion-toolbar>
    <ion-title>Ma liste de courses</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">
  <!-- Ã‰tat normal -->
  <ng-container *ngIf="!isLoading; else loadingTpl">
    <div class="page-wrapper">
      <!-- Infos utilisateur / liste -->
      <ion-item lines="none" class="info-item">
        <ion-label>
          <h2 class="title">Bonjour {{ pseudo }} !</h2>
          <p class="subtitle">
            Liste actuelle :
            <strong>{{ listId }}</strong>
          </p>
        </ion-label>
      </ion-item>

      <!-- Ajout d'un nouvel article -->
      <ion-list inset="true" lines="none" class="add-list">
        <ion-item>
          <ion-input
            placeholder="Ex : Lait, pÃ¢tes, pommes..."
            [(ngModel)]="newItemLabel"
            (keyup.enter)="addItem()"
          ></ion-input>
          <ion-button
            slot="end"
            (click)="addItem()"
            [disabled]="!newItemLabel || !newItemLabel.trim().length"
          >
            Ajouter
          </ion-button>
        </ion-item>
      </ion-list>

      <!-- Liste des items -->
      <ion-list inset="true" class="items-list" lines="none">
        <div
          class="item-wrapper"
          *ngFor="let item of (items$ | async) ?? []; trackBy: trackByItemId"
        >
          <ion-item-sliding>
            <ion-item lines="none" class="item-row">
              <ion-checkbox
                slot="start"
                color="primary"
                [checked]="item.status === 'bought'"
                (ionChange)="toggleItem(item)"
              ></ion-checkbox>

              <ion-label
              (click)="toggleItem(item)"
              >
                <h3
                  class="item-label"
                  [class.item-bought]="item.status === 'bought'"
                >
                  {{ item.label }}
                </h3>
                <p class="item-meta">
                  AjoutÃ© par <b>{{ item.addedBy }}</b>
                  <span
                    class="status-chip"
                    [ngClass]="{
                      'status-bought': item.status === 'bought',
                      'status-pending': item.status === 'pending'
                    }"
                  >
                    {{ item.status === 'bought' ? 'AchetÃ©' : 'Ã€ acheter' }}
                  </span>
                </p>
              </ion-label>
            </ion-item>

            <ion-item-options side="end">
              <ion-item-option color="medium" (click)="deleteItem(item)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </div>

        <!-- Message si la liste est vide -->
        <ion-item *ngIf="(items$ | async)?.length === 0" lines="none">
          <ion-label class="empty-label">
            Ta liste est vide, ajoute ton premier article ðŸ™‚
          </ion-label>
        </ion-item>
      </ion-list>
    </div>
  </ng-container>

  <!-- Ã‰tat de chargement -->
  <ng-template #loadingTpl>
    <div class="loading-wrapper ion-text-center">
      <ion-spinner></ion-spinner>
      <p>Chargement...</p>
    </div>
  </ng-template>

  <!-- Toast d'erreur -->
  <ion-toast
    [isOpen]="toastErrorOpen"
    [message]="errorMessage ?? ''"
    (didDismiss)="toastErrorOpen = false"
    duration="3500"
    color="danger"
    position="bottom"
  ></ion-toast>
</ion-content>